import{_ as j,u as I,R as M,C as P,r as n,o as q,b as d,c as p,w as t,V as O,d as g,e as l,f as E,g as y,q as U,s as G,x as L,v as u,h as o,z as x,i as k,S as _,G as V,j as R,y as T,T as W,U as H,F as J}from"./index-41a66bf6.js";const K={key:1,class:"text-caption text-medium-emphasis mt-2"},Q={__name:"CVView",setup(X){I();const h=M(),B=P(()=>h.isAuthenticated),c=n(!1),w=n(null),b=n(!1),r=n(null),i=n(!1),f=n(!1),v=n(""),S=[a=>{if(!a)return!0;const e=a.name.split(".").pop().toLowerCase();return["pdf","doc","docx"].includes(e)||"File must be a PDF or Word document"},a=>!a||a.size<5*1024*1024||"File size should be less than 5MB"],z=a=>{if(!a)return"";const e={year:"numeric",month:"long",day:"numeric"};return new Date(a).toLocaleDateString(void 0,e)},D=async()=>{try{const a=await g.head("/api/cv/download");c.value=a.status===200,a.headers["last-modified"]&&(w.value=new Date(a.headers["last-modified"]).toISOString())}catch(a){a.response&&a.response.status===404?c.value=!1:console.error("Error checking CV:",a)}},A=async()=>{if(c.value){b.value=!0;try{const a=await g.get("/api/cv/download",{responseType:"blob"}),e=window.URL.createObjectURL(new Blob([a.data])),s=document.createElement("a");s.href=e;const m=a.headers["content-disposition"];let F="Rajorshi_Tah_CV.pdf";if(m){const C=m.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);C&&C[1]&&(F=C[1].replace(/['"]/g,""))}s.setAttribute("download",F),document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(e)}catch(a){console.error("Error downloading CV:",a),alert("Failed to download CV. Please try again.")}finally{b.value=!1}}},N=async()=>{var e,s;if(!r.value)return;i.value=!0,f.value=!1,v.value="";const a=new FormData;a.append("file",r.value);try{await g.post("/api/cv/upload",a,{headers:{"Content-Type":"multipart/form-data"}}),r.value=null,f.value=!0,await D(),setTimeout(()=>{f.value=!1},5e3)}catch(m){console.error("Error uploading CV:",m),v.value=((s=(e=m.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to upload CV. Please try again."}finally{i.value=!1}};return q(()=>{D()}),(a,e)=>(d(),p(O,{class:"cv-container py-8"},{default:t(()=>[l(U,null,{default:t(()=>[l(E,{cols:"12",class:"text-center"},{default:t(()=>[...e[1]||(e[1]=[y("h1",{class:"text-h3 font-weight-bold mb-2"},"My CV",-1),y("p",{class:"text-body-1 text-medium-emphasis mb-8"}," Download my latest resume or upload a new version (admin only) ",-1)])]),_:1})]),_:1}),l(U,{justify:"center"},{default:t(()=>[l(E,{cols:"12",md:"8",lg:"6"},{default:t(()=>[l(G,{class:"pa-6",elevation:"2"},{default:t(()=>[l(L,{class:"text-h5 mb-4 d-flex align-center"},{default:t(()=>[l(u,{icon:"mdi-file-account",class:"mr-3",color:"primary"}),e[2]||(e[2]=o(" Download CV ",-1))]),_:1}),l(x,{class:"text-center"},{default:t(()=>[l(u,{size:"64",color:"primary",class:"mb-4"},{default:t(()=>[...e[3]||(e[3]=[o("mdi-file-download",-1)])]),_:1}),e[7]||(e[7]=y("p",{class:"text-body-1 mb-4"}," Click the button below to download my latest CV in PDF format. ",-1)),l(k,{color:"primary",size:"large",loading:b.value,disabled:!c.value,onClick:A,class:"mb-4",rounded:""},{default:t(()=>[l(u,{start:""},{default:t(()=>[...e[4]||(e[4]=[o("mdi-download",-1)])]),_:1}),e[5]||(e[5]=o(" Download CV ",-1))]),_:1},8,["loading","disabled"]),c.value?V("",!0):(d(),p(_,{key:0,type:"info",variant:"tonal",class:"mb-4"},{default:t(()=>[...e[6]||(e[6]=[o(" No CV has been uploaded yet. ",-1)])]),_:1})),w.value?(d(),R("p",K," Last updated: "+T(z(w.value)),1)):V("",!0)]),_:1}),l(W,{class:"my-6"}),B.value?(d(),R(J,{key:0},[l(L,{class:"text-h5 mb-4 d-flex align-center"},{default:t(()=>[l(u,{icon:"mdi-upload",class:"mr-3",color:"primary"}),e[8]||(e[8]=o(" Upload New CV ",-1))]),_:1}),l(x,null,{default:t(()=>[f.value?(d(),p(_,{key:0,type:"success",variant:"tonal",class:"mb-4"},{default:t(()=>[...e[9]||(e[9]=[o(" CV uploaded successfully! ",-1)])]),_:1})):V("",!0),v.value?(d(),p(_,{key:1,type:"error",variant:"tonal",class:"mb-4"},{default:t(()=>[o(T(v.value),1)]),_:1})):V("",!0),l(H,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=s=>r.value=s),rules:S,accept:".pdf,.doc,.docx",label:"CV File","prepend-icon":"mdi-file",variant:"outlined",loading:i.value,disabled:i.value,class:"mb-4"},null,8,["modelValue","loading","disabled"]),l(k,{color:"primary",loading:i.value,disabled:!r.value||i.value,block:"",onClick:N,rounded:""},{default:t(()=>[l(u,{start:""},{default:t(()=>[...e[10]||(e[10]=[o("mdi-upload",-1)])]),_:1}),e[11]||(e[11]=o(" Upload CV ",-1))]),_:1},8,["loading","disabled"])]),_:1})],64)):(d(),p(x,{key:1,class:"text-center"},{default:t(()=>[l(u,{size:"48",color:"primary",class:"mb-4"},{default:t(()=>[...e[12]||(e[12]=[o("mdi-lock",-1)])]),_:1}),e[14]||(e[14]=y("p",{class:"text-body-1 mb-4"}," Admin access is required to upload a new CV. ",-1)),l(k,{color:"primary",variant:"text",to:{name:"login",query:{redirect:"/cv"}},class:"mt-2"},{default:t(()=>[...e[13]||(e[13]=[o(" Login ",-1)])]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}))}},Z=j(Q,[["__scopeId","data-v-9146cd60"]]);export{Z as default};
